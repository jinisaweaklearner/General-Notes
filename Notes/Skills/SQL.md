### ODBC vs JDBCC
 - JDBC is known as Java Database Community is the application programming interface for java
 - ODBC is known as Open Database Connectivity is the industry-standard application programming interface for various programming languages and applications for database connectivity and retrieval

### Null
when use `like`, we won't get the record of Null values.

### Like | case insensitive
```
select *
from client.service
where upper(service_name) like '%TEST%';
```

### create table if not exsits
```
create table if not exists table_name (...)
```

### Grant access
```
alter table xx.xxxx owner to your_user_name;
grant select on xx.xxxx to prod_ro;
grant insert, update, delete, truncate on xx.xxxx to prod_create;


grant usage on schema xx to prod_ro;
grant select on all tables in schema xx to prod_ro;
grant create on schema xx to prod_admin;
grant insert, update, delete, truncate on all tables in schema xx to prod_create;
grant all privileges on all functions in schema xx to prod_create;
```

### Auto columns
```
etl_created_by          varchar(100) default CURRENT_USER not null,
etl_created_ts          timestamp    default now()        not null,
etl_id                  integer generated by default as identity
```

### PK
```
portfolio_id varchar(20) not null
    constraint portfolio_pkey primary key,
```

## Year Month
```
select EXTRACT(YEAR FROM transaction_date) AS YEAR,
       EXTRACT(MONTH FROM transaction_date) AS MONTH
from table       
```

## CAST
```
CAST(sum(DailyCount) AS FLOAT) / CAST(count(*) AS FLOAT) as avg_count
```

## TO_CHAT
https://www.postgresql.org/docs/9.6/functions-formatting.html
```
select TO_CHAR(created_date, 'month') AS "month"
from jira.service_desk

output:
september
```

### IF ELSE
```
IF EXISTS ( select * from praemium.fum_stats_summary where as_at_date = '{date_this_week}')
BEGIN
DELETE FROM praemium.fum_stats_summary  WHERE as_at_date = '{date_this_week}';
INSERT INTO praemium.fum_stats_summary(as_at_date,total_fum,source)  values('{date_this_week}','{df_this_summary['Value'].sum()}','Portfolio_Valuation')
END
ELSE
BEGIN
INSERT INTO praemium.fum_stats_summary(as_at_date,total_fum,source)  values('{date_this_week}','{df_this_summary['Value'].sum()}','Portfolio_Valuation')
END
```

### CASE
```
CASE
WHEN AssetClassCode IN ('LOAN', 'CAS') THEN 'UNL'
WHEN s.Exchange_Code IS NULL THEN AssetClassCode
ELSE s.Exchange_Code END AS Exchange_Code,
```

## check column names
```
Select * From db_name.INFORMATION_SCHEMA.COLUMNS
where column_name like '%username%'
```

## check table names
```
select * from db_name.information_schema.TABLES
where lower(table_name) like '%keyword%'
```
## check number of rows in all tables
```
SELECT t.name, s.row_count from sys.tables t
JOIN sys.dm_db_partition_stats s
ON t.object_id = s.object_id
AND t.type_desc = 'USER_TABLE'
-- AND t.name not like '%dss%'
AND s.index_id IN (0,1)
order by row_count desc
```

### delete data but not table
```
TRUNCATE TABLE table_name;
```

### catch
A TRY...CATCH construct catches all execution errors that have a severity higher than 10 that do not close the database connection.
```
BEGIN TRY  
     { sql_statement | statement_block }  
END TRY  
BEGIN CATCH  
     [ { sql_statement | statement_block } ]  
END CATCH  
[ ; ]  
```


### COALESCE
```
The COALESCE() function returns the first non-null value in a list.
COALESCE(a.Product,c.Product)
```
